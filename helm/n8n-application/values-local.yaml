# Local Environment Configuration for n8n
# Runtime: WSL + Minikube
# Purpose: Development and testing

replicaCount: 1
namespace: n8n-local

image:
  repository: n8nio/n8n
  pullPolicy: IfNotPresent
  tag: "1.19.4"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

# LOCAL: Relaxed security context for easier debugging
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false  # LOCAL: writable for debugging
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  className: "nginx"  # LOCAL: Minikube nginx addon
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  hosts:
    - host: n8n.local
      paths:
        - path: /
          pathType: Prefix
  tls: []  # LOCAL: No TLS for local development

# LOCAL: Lightweight resources for Minikube
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

autoscaling:
  enabled: false

nodeSelector: {}
tolerations: []
affinity: {}

# n8n specific configuration
n8n:
  host: "0.0.0.0"
  port: 5678
  protocol: "http"  # LOCAL: No HTTPS locally

# PostgreSQL configuration
postgres:
  image:
    repository: postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  persistence:
    storageClass: "standard"  # LOCAL: Minikube default
    size: 5Gi

# Database connection
database:
  type: "postgresdb"
  host: "postgres-service"
  port: 5432
  database: "n8n"
  username: "n8n"
  password: "changeme"  # LOCAL: Acceptable for local dev only

# N8N data persistence
persistence:
  enabled: true
  storageClass: "standard"  # LOCAL: Minikube default
  accessMode: ReadWriteOnce
  size: 1Gi

# Network Policy
networkPolicy:
  enabled: false  # LOCAL: Not needed for development

# External Secrets Configuration
externalSecrets:
  enabled: false  # LOCAL: Use inline secrets
  refreshInterval: "1h"
  vault:
    address: "http://vault.vault.svc.cluster.local:8200"
    kvPath: "secret"
    kvVersion: "v2"
    secretPath: "n8n/local/postgres"
    auth:
      mountPath: "kubernetes"
      role: "n8n-local"
      serviceAccount: ""

# Backup
backup:
  enabled: false  # LOCAL: No backups needed
